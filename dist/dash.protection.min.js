!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dashjs=t():e.dashjs=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=70)}({1:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t,n,s;return t=e,(n=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_PADA="abrPada",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4}}}])&&r(t.prototype,n),s&&r(t,s),e}());t.a=s},14:function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"mixin",value:function(t,n,s){var i,a={};if(t)for(var o in n)n.hasOwnProperty(o)&&(i=n[o],o in t&&(t[o]===i||o in a&&a[o]===i)||("object"===r(t[o])&&null!==t[o]?t[o]=e.mixin(t[o],i,s):t[o]=s(i)));return t}},{key:"clone",value:function(t){if(!t||"object"!==r(t))return t;var n;if(t instanceof Array){n=[];for(var s=0,i=t.length;s<i;++s)s in t&&n.push(e.clone(t[s]))}else n={};return e.mixin(n,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var n=new URL(e);return t.forEach((function(e){e.key&&e.value&&n.searchParams.set(e.key,e.value)})),n.href}catch(t){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var n=e.trim().split("\r\n"),r=0,s=n.length;r<s;r++){var i=n[r],a=i.indexOf(": ");a>0&&(t[i.substring(0,a)]=i.substring(a+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}}],(n=null)&&s(t.prototype,n),i&&s(t,i),e}();t.a=i},17:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s;return t=e,(n=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var s in e)!e.hasOwnProperty(s)||this[s]&&!n||r&&-1===e[s].indexOf("public_")||(this[s]=e[s])}}}])&&r(t.prototype,n),s&&r(t,s),e}();t.a=s},24:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s;return t=e,(n=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var s in e)!e.hasOwnProperty(s)||this[s]&&!n||r&&-1===e[s].indexOf("public_")||(this[s]=e[s])}}}])&&r(t.prototype,n),s&&r(t,s),e}();t.a=s},5:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return i}));var s=function e(){r(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null},i=function e(){r(this,e),this.s=null,this.d=null,this.b=[],this.t=null};s.GET="GET",s.HEAD="HEAD",s.MPD_TYPE="MPD",s.XLINK_EXPANSION_TYPE="XLinkExpansion",s.INIT_SEGMENT_TYPE="InitializationSegment",s.INDEX_SEGMENT_TYPE="IndexSegment",s.MEDIA_SEGMENT_TYPE="MediaSegment",s.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",s.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",s.LICENSE="license",s.OTHER_TYPE="other"},70:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s;return t=e,s=[{key:"findCencContentProtection",value:function(e){for(var t=null,n=0;n<e.length;++n){var r=e[n];"urn:mpeg:dash:mp4protection:2011"!==r.schemeIdUri.toLowerCase()||"cenc"!==r.value.toLowerCase()&&"cbcs"!==r.value.toLowerCase()||(t=r)}return t}},{key:"getPSSHData",value:function(e){var t=8,n=new DataView(e),r=n.getUint8(t);return t+=20,r>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,n){var r=e.parsePSSHList(n);return t&&r.hasOwnProperty(t.uuid.toLowerCase())?r[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),n={},r=0;;){var s,i,a=void 0,o=r;if(r>=t.buffer.byteLength)break;if(s=r+t.getUint32(r),r+=4,1886614376===t.getUint32(r))if(r+=4,0===(i=t.getUint8(r))||1===i){r++,r+=3,a="";var u=void 0,E=void 0;for(u=0;u<4;u++)a+=1===(E=t.getUint8(r+u).toString(16)).length?"0"+E:E;for(r+=4,a+="-",u=0;u<2;u++)a+=1===(E=t.getUint8(r+u).toString(16)).length?"0"+E:E;for(r+=2,a+="-",u=0;u<2;u++)a+=1===(E=t.getUint8(r+u).toString(16)).length?"0"+E:E;for(r+=2,a+="-",u=0;u<2;u++)a+=1===(E=t.getUint8(r+u).toString(16)).length?"0"+E:E;for(r+=2,a+="-",u=0;u<6;u++)a+=1===(E=t.getUint8(r+u).toString(16)).length?"0"+E:E;r+=6,r+=4,n[a=a.toLowerCase()]=t.buffer.slice(o,s),r=s}else r=s;else r=s}return n}}],(n=null)&&r(t.prototype,n),s&&r(t,s),e}();var i=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=n};var a=function e(t,n,r,s,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),n&&n.length&&(this.videoCapabilities=n),this.distinctiveIdentifier=r,this.persistentState=s,this.sessionTypes=i};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var s=l(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,e);var t=E(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}return n}(n(24).a)),y=n(8);var S=function e(t,n,r,s,i,a,o,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.method=n,this.responseType=r,this.headers=s,this.withCredentials=i,this.messageType=a,this.sessionId=o,this.data=u};var d=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.headers=n,this.data=r},_=n(5),g=n(14),h=n(1);function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e){var t,n,r,o,u,E,c,l,p,m,D=(e=e||{}).protectionKeyController,v=e.protectionModel,C=e.eventBus,T=e.events,A=e.debug,M=e.BASE64,I=e.constants,K=[],O=e.cmcdModel,N=e.settings;function b(){if(!(C&&C.hasOwnProperty("on")&&D&&D.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function w(e,t){var n=s.getPSSHForKeySystem(l,e),r=P(l);if(n){if(L(n))return;try{v.createKeySession(n,r,G(l),t)}catch(e){C.trigger(T.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e?v.createKeySession(e,r,G(l),t):C.trigger(T.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(l?l.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function L(e){if(!e)return!1;try{for(var t=v.getAllInitData(),r=0;r<t.length;r++)if(D.initDataEquals(e,t[r]))return n.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function k(e,t){b(),v.loadKeySession(e,t,G(l))}function Y(e){b(),e?(v.setMediaElement(e),C.on(T.NEED_KEY,j,this)):null===e&&(v.setMediaElement(e),C.off(T.NEED_KEY,j,this))}function P(e){var t=null;if(e){var n=e.systemString;u&&(t=n in u?u[n]:null)}return t}function U(e){var t=P(e),n=[],r=[],s=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:c,u=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:c,E=G(e),l=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",f=t&&t.persistentState?t.persistentState:"temporary"===E?"optional":"required";return o.forEach((function(e){e.type===I.AUDIO?n.push(new i(e.codec,s)):e.type===I.VIDEO&&r.push(new i(e.codec,u))})),new a(n,r,l,f,[E])}function G(e){var t=P(e);return t&&t.sessionType?t.sessionType:E}function F(e,t){e=e.sort((function(t,n){return(u&&u[t.ks.systemString]&&u[t.ks.systemString].priority>=0?u[t.ks.systemString].priority:e.length)-(u&&u[n.ks.systemString]&&u[n.ks.systemString].priority>=0?u[n.ks.systemString].priority:e.length)})),void 0===l?function(e,t){var s,i,a=this,o=[];l=null,r.push(e);for(var u=0;u<e.length;u++)o.push({ks:e[u].ks,configs:[U(e[u].ks)]});var E=function e(r){C.off(T.KEY_SYSTEM_ACCESS_COMPLETE,e,a),r.error?(l=void 0,C.off(T.INTERNAL_KEY_SYSTEM_SELECTED,c,a),t||C.trigger(T.KEY_SYSTEM_SELECTED,{data:null,error:new y.a(f.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,f.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+r.error)})):(i=r.data,n.info("DRM: KeySystem Access Granted ("+i.keySystem.systemString+")!  Selecting key system..."),v.selectKeySystem(i))},c=function e(n){if(C.off(T.INTERNAL_KEY_SYSTEM_SELECTED,e,a),C.off(T.KEY_SYSTEM_ACCESS_COMPLETE,E,a),n.error)l=void 0,t||C.trigger(T.KEY_SYSTEM_SELECTED,{data:null,error:new y.a(f.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,f.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+n.error)});else{if(!v)return;l=v.getKeySystem(),C.trigger(T.KEY_SYSTEM_SELECTED,{data:i});var o=P(l);o&&o.serverCertificate&&o.serverCertificate.length>0&&v.setServerCertificate(M.decodeArray(o.serverCertificate).buffer);for(var u=0;u<r.length;u++)for(s=0;s<r[u].length;s++)if(l===r[u][s].ks){if(D.isClearKey(l)&&o&&o.hasOwnProperty("clearkeys")){var c={kids:Object.keys(o.clearkeys)};r[u][s].initData=(new TextEncoder).encode(JSON.stringify(c))}r[u][s].sessionId?k(r[u][s].sessionId,r[u][s].initData):null!==r[u][s].initData&&w(r[u][s].initData,r[u][s].cdmData);break}}};C.on(T.INTERNAL_KEY_SYSTEM_SELECTED,c,a),C.on(T.KEY_SYSTEM_ACCESS_COMPLETE,E,a),v.requestKeySystemAccess(o)}(e,t):l?function(e,t){var r=this,i=[],a=e.findIndex((function(e){return e.ks===l}));if(-1===a||!e[a].initData)return;if(L(s.getPSSHForKeySystem(l,e[a].initData)))return;i.push({ks:e[a].ks,configs:[U(l)]});C.on(T.KEY_SYSTEM_ACCESS_COMPLETE,(function s(i){if(C.off(T.KEY_SYSTEM_ACCESS_COMPLETE,s,r),i.error)t||C.trigger(T.KEY_SYSTEM_SELECTED,{error:new y.a(f.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,f.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+i.error)});else{n.info("DRM: KeySystem Access Granted"),C.trigger(T.KEY_SYSTEM_SELECTED,{data:i.data});var o=P(l);if(D.isClearKey(l)&&o&&o.hasOwnProperty("clearkeys")){var u={kids:Object.keys(o.clearkeys)};e[a].initData=(new TextEncoder).encode(JSON.stringify(u))}e[a].sessionId?k(e[a].sessionId,e[a].initData):e[a].initData&&w(e[a].initData,e[a].cdmData)}}),r),v.requestKeySystemAccess(i)}(e,t):r.push(e)}function H(e,t){C.trigger(T.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function x(e){e.error?C.trigger(T.KEY_STATUSES_CHANGED,{data:null,error:e.error}):n.debug("DRM: key status = "+e.status)}function B(e){n.debug("DRM: onKeyMessage");var t=e.data;C.trigger(T.KEY_MESSAGE,{data:t});var r=t.messageType?t.messageType:"license-request",i=t.message,a=t.sessionToken,u=P(l),E=l?l.systemString:null,c=D.getLicenseServer(l,u,r),A={sessionToken:a,messageType:r};if(i&&0!==i.byteLength){if(!c)return n.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+a.getSessionID()),void H(A);if(D.isClearKey(l)){var M=D.processClearKeyLicenseRequest(l,u,i);if(M)return n.debug("DRM: ClearKey license request handled by application!"),H(A),void v.updateKeySession(a,M)}var I=null;if(u&&u.serverURL){var K=u.serverURL;"string"==typeof K&&""!==K?I=K:"object"===R(K)&&K.hasOwnProperty(r)&&(I=K[r])}else if(u&&u.laURL&&""!==u.laURL)I=u.laURL;else if(D.isClearKey(l))I=l.getLicenseServerUrlFromMediaInfo(o);else{var b=s.getPSSHData(a.initData);(I=l.getLicenseServerURLFromInitData(b))||(I=e.data.laURL)}if(I=c.getServerURLFromMessage(I,i,r)){var w={},L=!1,k=function(e){if(e)for(var t in e)"authorization"===t.toLowerCase()&&(L=!0),w[t]=e[t]};u&&k(u.httpRequestHeaders),k(l.getRequestHeadersFromMessage(i)),u&&"boolean"==typeof u.withCredentials&&(L=u.withCredentials);var Y=function(e,t,n,r){var s=e.response?c.getErrorResponse(e.response,n,r):"NONE";H(t,new y.a(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+n+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+s))},U=function(e){if(v)if(200===e.status){var t=new d(e.responseURL,g.a.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),e.response);V(m,t).then((function(){var n=c.getLicenseMessage(t.data,E,r);null!==n?(H(A),v.updateKeySession(a,n)):Y(e,A,E,r)}))}else Y(e,A,E,r)},G=function(e){H(A,new y.a(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+E+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},F=function(e){H(A,new y.a(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+E+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},x=l.getLicenseRequestFromMessage(i),B=c.getHTTPMethod(r),j=c.getResponseType(E,r),q=u&&!isNaN(u.httpTimeout)?u.httpTimeout:8e3,W=a.getSessionID()||null,X=new S(I,B,j,w,L,r,W,x),J=isNaN(N.get().streaming.retryAttempts[_.a.LICENSE])?3:N.get().streaming.retryAttempts[_.a.LICENSE];V(p,X).then((function(){!function e(t,r,s,i,a,o){var u=new XMLHttpRequest;if(N.get().streaming.cmcd&&N.get().streaming.cmcd.enabled){if(N.get().streaming.cmcd.mode===h.a.CMCD_MODE_QUERY){var E=O.getQueryParameter({url:t.url,type:_.a.LICENSE});E&&(t.url=g.a.addAditionalQueryParameterToUrl(t.url,[E]))}}u.open(t.method,t.url,!0),u.responseType=t.responseType,u.withCredentials=t.withCredentials,s>0&&(u.timeout=s);for(var c in t.headers)u.setRequestHeader(c,t.headers[c]);if(N.get().streaming.cmcd&&N.get().streaming.cmcd.enabled){if(N.get().streaming.cmcd.mode===h.a.CMCD_MODE_HEADER){var l=O.getHeaderParameters({url:t.url,type:_.a.LICENSE});if(l)for(var f in l){var y=l[f];y&&u.setRequestHeader(f,y)}}}var S=function(){r--;var n=isNaN(N.get().streaming.retryIntervals[_.a.LICENSE])?1e3:N.get().streaming.retryIntervals[_.a.LICENSE];setTimeout((function(){e(t,r,s,i,a,o)}),n)};u.onload=function(){200===this.status||r<=0?i(this):(n.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+r),S())},u.ontimeout=u.onerror=function(){r<=0?o(this):(n.warn("License request network request failed . Retrying it... Pending retries: "+r),S())},u.onabort=function(){a(this)},C.trigger(T.LICENSE_REQUEST_SENDING,{url:t.url,headers:t.headers,payload:t.data,sessionId:t.sessionId}),u.send(t.data)}(X,J,q,U,G,F)}))}else H(A,new y.a(f.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,f.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}else H(A,new y.a(f.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,f.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function j(e,t){if(n.debug("DRM: onNeedKey"),"cenc"===e.key.initDataType)if(0===o.length&&(n.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(t=void 0===t?1:t+1)<5))K.push(setTimeout((function(){j(e,t)}),500));else{var r=e.key.initData;if(ArrayBuffer.isView(r)&&(r=r.buffer),l){var i=s.getPSSHForKeySystem(l,r);if(i&&L(i))return}n.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(r)));var a=D.getSupportedKeySystems(r,u);0!==a.length?F(a,!1):n.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!")}else n.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType)}function V(e,t){return e?e.reduce((function(e,n){return e.then((function(){return n(t)}))}),Promise.resolve()):Promise.resolve()}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");b(),C.on(T.INTERNAL_KEY_MESSAGE,B,this),C.on(T.INTERNAL_KEY_STATUS_CHANGED,x,this),o.push(e);var t=D.getSupportedKeySystemsFromContentProtection(e.contentProtection);t&&t.length>0&&F(t,!0)},clearMediaInfoArrayByStreamId:function(e){o=o.filter((function(t){return t.streamInfo.id!==e}))},createKeySession:w,loadKeySession:k,removeKeySession:function(e){b(),v.removeKeySession(e)},closeKeySession:function(e){b(),v.closeKeySession(e)},setServerCertificate:function(e){b(),v.setServerCertificate(e)},setMediaElement:Y,setSessionType:function(e){E=e},setRobustnessLevel:function(e){c=e},setProtectionData:function(e){u=e,D.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return b(),D.getSupportedKeySystemsFromContentProtection(e)},getKeySystems:function(){return D?D.getKeySystems():[]},setKeySystems:function(e){D&&D.setKeySystems(e)},setLicenseRequestFilters:function(e){p=e},setLicenseResponseFilters:function(e){m=e},stop:function(){v&&v.stop()},reset:function(){b(),p=[],m=[],C.off(T.INTERNAL_KEY_MESSAGE,B,this),C.off(T.INTERNAL_KEY_STATUS_CHANGED,x,this),Y(null),l=void 0,v&&(v.reset(),v=null),K.forEach((function(e){return clearTimeout(e)})),K=[],o=[]}},n=A.getLogger(t),r=[],o=[],E="temporary",c="",p=[],m=[],t}p.__dashjs_factory_name="ProtectionController";var m=dashjs.FactoryMaker.getClassFactory(p);var D=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=n};function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"persistent"!==n&&"temporary"!==n)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=n}var t,n,r;return t=e,(n=[{key:"toJWK",value:function(){var e,t=this.keyPairs.length,n={keys:[]};for(e=0;e<t;e++){var r={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(r)}this.type&&(n.type=this.type);var s=JSON.stringify(n),i=s.length,a=new ArrayBuffer(i),o=new Uint8Array(a);for(e=0;e<i;e++)o[e]=s.charCodeAt(e);return a}}])&&v(t.prototype,n),r&&v(t,r),e}();function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t,n,r;return t=e,(n=[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready"}}])&&T(t.prototype,n),r&&T(t,r),e}()),M="e2719d58-a985-b3c9-781a-b030af78d30e",I=A.CLEARKEY_KEYSTEM_STRING,K="urn:uuid:"+M;function O(e){var t=(e=e||{}).BASE64,n={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]};return{uuid:M,schemeIdURI:K,systemString:I,getInitData:function(e,n){try{var r=s.parseInitDataFromContentProtection(e,t);if(!r&&n){var i={kids:[function(e){try{var t=e.replace(/-/g,"");return(t=btoa(t.match(/\w{2}/g).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))).replace(/=/g,"")}catch(e){return null}}(n["cenc:default_KID"])]};r=(new TextEncoder).encode(JSON.stringify(i))}return r}catch(e){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getLicenseServerUrlFromMediaInfo:function(e){try{if(!e||0===e.length)return null;for(var t=0,r=null;t<e.length&&!r;){var s=e[t];if(s&&s.contentProtection&&s.contentProtection.length>0){var i=s.contentProtection.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===K}));if(i&&i.length>0)for(var a=0;a<i.length&&!r;){for(var o=i[a],u=0;u<n.attributes.length&&!r;){for(var E=0,c=n.attributes[u];E<n.prefixes.length&&!r;){var l=n.prefixes[E];o[c]&&o[c].__prefix&&o[c].__prefix===l&&o[c].__text&&(r=o[c].__text),E+=1}u+=1}a+=1}}t+=1}return r}catch(e){return null}},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),s=[],i=0;i<r.kids.length;i++){var a=r.kids[i],o=e.clearkeys&&e.clearkeys.hasOwnProperty(a)?e.clearkeys[a]:null;if(!o)throw new Error("DRM: ClearKey keyID ("+a+") is not known!");s.push(new D(a,o))}n=new C(s)}return n}}}O.__dashjs_factory_name="KeySystemClearKey";var N=dashjs.FactoryMaker.getSingletonFactory(O),b=A.CLEARKEY_KEYSTEM_STRING;function w(e){var t,n=e.BASE64,r=e.debug.getLogger(t);return t={uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:b,getInitData:function(e){return s.parseInitDataFromContentProtection(e,n)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var s=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=[],a=0;a<s.kids.length;a++){var o=s.kids[a],u=e.clearkeys&&e.clearkeys.hasOwnProperty(o)?e.clearkeys[o]:null;if(!u)throw new Error("DRM: ClearKey keyID ("+o+") is not known!");i.push(new D(o,u))}n=new C(i),r.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return n}}}w.__dashjs_factory_name="KeySystemW3CClearKey";var L=dashjs.FactoryMaker.getSingletonFactory(w),k=A.WIDEVINE_KEYSTEM_STRING;function Y(e){var t=null,n=(e=e||{}).BASE64;return{uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:k,init:function(e){e&&(t=e)},getInitData:function(e){return s.parseInitDataFromContentProtection(e,n)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(e){return t&&t.sessionId?t.sessionId:e&&e.sessionId?e.sessionId:null}}}Y.__dashjs_factory_name="KeySystemWidevine";var P,U=dashjs.FactoryMaker.getSingletonFactory(Y),G=A.PLAYREADY_KEYSTEM_STRING;function F(e){var t="utf-16",n=(e=e||{}).BASE64;function r(){if(!n||!n.hasOwnProperty("decodeArray")||!n.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:"9a04f079-9840-4286-ab92-e65be0885f95",schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:G,getInitData:function(e){var t,i,a,o,u,E=new Uint8Array([112,115,115,104,0,0,0,0]),c=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),l=0,f=null;if(r(),!e)return null;if("pssh"in e)return s.parseInitDataFromContentProtection(e,n);if("pro"in e)f=n.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;f=n.decodeArray(e.prheader.__text)}return t=f.length,i=4+E.length+c.length+4+t,a=new ArrayBuffer(i),o=new Uint8Array(a),(u=new DataView(a)).setUint32(l,i),l+=4,o.set(E,l),l+=E.length,o.set(c,l),l+=c.length,u.setUint32(l,t),l+=4,o.set(f,l),l+=t,o.buffer},getRequestHeadersFromMessage:function(e){var n,r,s={},i=new DOMParser,a="utf-16"===t?new Uint16Array(e):new Uint8Array(e);n=String.fromCharCode.apply(null,a);for(var o=(r=i.parseFromString(n,"application/xml")).getElementsByTagName("name"),u=r.getElementsByTagName("value"),E=0;E<o.length;E++)s[o[E].childNodes[0].nodeValue]=u[E].childNodes[0].nodeValue;return s.hasOwnProperty("Content")&&(s["Content-Type"]=s.Content,delete s.Content),s.hasOwnProperty("Content-Type")||(s["Content-Type"]="text/xml; charset=utf-8"),s},getLicenseRequestFromMessage:function(e){var s=null,i=new DOMParser,a="utf-16"===t?new Uint16Array(e):new Uint8Array(e);r();var o=String.fromCharCode.apply(null,a),u=i.parseFromString(o,"application/xml");if(!u.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var E=u.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return E&&(s=n.decode(E)),s},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),n=t.getUint16(4,!0),r=6,s=new DOMParser,i=0;i<n;i++){var a=t.getUint16(r,!0);r+=2;var o=t.getUint16(r,!0);if(r+=2,1===a){var u=e.slice(r,r+o),E=String.fromCharCode.apply(null,new Uint16Array(u)),c=s.parseFromString(E,"application/xml");if(c.getElementsByTagName("LA_URL")[0]){var l=c.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(l)return l}if(c.getElementsByTagName("LUI_URL")[0]){var f=c.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(f)return f}}else r+=o}return null},getCDMData:function(){var e,t,s,i;if(r(),P&&P.cdmData){for(e=[],i=0;i<P.cdmData.length;++i)e.push(P.cdmData.charCodeAt(i)),e.push(0);for(e=String.fromCharCode.apply(null,e),e=n.encode(e),t='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",e),s=[],i=0;i<t.length;++i)s.push(t.charCodeAt(i)),s.push(0);return new Uint8Array(s).buffer}return null},getSessionId:function(e){return P&&P.sessionId?P.sessionId:e&&e.sessionId?e.sessionId:null},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');t=e},init:function(e){e&&(P=e)}}}F.__dashjs_factory_name="KeySystemPlayReady";var H=dashjs.FactoryMaker.getSingletonFactory(F);function x(e){var t=(e=e||{}).BASE64,n={};return n[A.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},n[A.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return n[e].responseType},getLicenseMessage:function(e,r){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),n[r].getLicenseMessage(e)},getErrorResponse:function(e,t){return n[t].getErrorResponse(e)}}}x.__dashjs_factory_name="DRMToday";var B=dashjs.FactoryMaker.getSingletonFactory(x);function j(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function n(n){if(window.DOMParser){var r=t(n),s=(new window.DOMParser).parseFromString(r,"text/xml"),i=s?s.getElementsByTagNameNS(e,"Envelope")[0]:null,a=i?i.getElementsByTagNameNS(e,"Body")[0]:null;if(a?a.getElementsByTagNameNS(e,"Fault")[0]:null)return null}return n}function r(n){var r="",s="",i="",a=-1,o=-1;if(window.DOMParser){var u=t(n),E=(new window.DOMParser).parseFromString(u,"text/xml"),c=E?E.getElementsByTagNameNS(e,"Envelope")[0]:null,l=c?c.getElementsByTagNameNS(e,"Body")[0]:null,f=l?l.getElementsByTagNameNS(e,"Fault")[0]:null,y=f?f.getElementsByTagName("detail")[0]:null,S=y?y.getElementsByTagName("Exception")[0]:null,d=null;if(null===f)return u;r=(d=f.getElementsByTagName("faultstring")[0].firstChild)?d.nodeValue:null,null!==S&&(s=(d=S.getElementsByTagName("StatusCode")[0])?d.firstChild.nodeValue:null,a=(i=(d=S.getElementsByTagName("Message")[0])?d.firstChild.nodeValue:null)?i.lastIndexOf("[")+1:-1,o=i?i.indexOf("]"):-1,i=i?i.substring(a,o):"")}var _="code: ".concat(s,", name: ").concat(r);return i&&(_+=", message: ".concat(i)),_}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return n.call(this,e)},getErrorResponse:function(e){return r.call(this,e)}}}j.__dashjs_factory_name="PlayReady";var V=dashjs.FactoryMaker.getSingletonFactory(j);function q(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}q.__dashjs_factory_name="Widevine";var W=dashjs.FactoryMaker.getSingletonFactory(q);function X(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],n=0;n<e.keys.length;n++){var r=e.keys[n],s=r.kid.replace(/=/g,""),i=r.k.replace(/=/g,"");t.push(new D(s,i))}return new C(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}X.__dashjs_factory_name="ClearKey";var J=dashjs.FactoryMaker.getSingletonFactory(X);function z(){var e,t,n,r,i,a,o,u=this.context;return e={initialize:function(){var e;r=[],e=H(u).getInstance({BASE64:i}),r.push(e),e=U(u).getInstance({BASE64:i}),r.push(e),e=N(u).getInstance({BASE64:i}),r.push(e),a=e,e=L(u).getInstance({BASE64:i,debug:t}),r.push(e),o=e},setProtectionData:function(e){for(var t,n,s=0;s<r.length;s++){var i=r[s];i.hasOwnProperty("init")&&i.init((t=i.systemString,n=void 0,n=null,e&&(n=t in e?e[t]:null),n))}},isClearKey:function(e){return e===a||e===o},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var n=new Uint8Array(e),r=new Uint8Array(t),s=0;s<n.length;s++)if(n[s]!==r[s])return!1;return!0}return!1},getKeySystems:function(){return r},setKeySystems:function(e){r=e},getKeySystemBySystemString:function(e){for(var t=0;t<r.length;t++)if(r[t].systemString===e)return r[t];return null},getSupportedKeySystemsFromContentProtection:function(e){var t,n,i,a,o=[];if(e){var u=s.findCencContentProtection(e);for(i=0;i<r.length;++i)for(n=r[i],a=0;a<e.length;++a)if((t=e[a]).schemeIdUri.toLowerCase()===n.schemeIdURI){var E=n.getInitData(t,u);o.push({ks:r[i],initData:E,cdmData:n.getCDMData(),sessionId:n.getSessionId(t)})}}return o},getSupportedKeySystems:function(e,t){for(var n,i,a,o=[],u=s.parsePSSHList(e),E=0;E<r.length;++E)i=(n=r[E]).systemString,a=!t||i in t,n.uuid in u&&a&&o.push({ks:n,initData:u[n.uuid],cdmData:n.getCDMData(),sessionId:n.getSessionId()});return o},getLicenseServer:function(e,t,n){if("license-release"===n||"individualization-request"===n)return null;var r=null;return t&&t.hasOwnProperty("drmtoday")?r=B(u).getInstance({BASE64:i}):e.systemString===A.WIDEVINE_KEYSTEM_STRING?r=W(u).getInstance():e.systemString===A.PLAYREADY_KEYSTEM_STRING?r=V(u).getInstance():e.systemString===A.CLEARKEY_KEYSTEM_STRING&&(r=J(u).getInstance()),r},processClearKeyLicenseRequest:function(e,t,r){try{return e.getClearKeysFromProtectionData(t,r)}catch(e){return n.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(r){r&&(r.debug&&(t=r.debug,n=t.getLogger(e)),r.BASE64&&(i=r.BASE64))}}}z.__dashjs_factory_name="ProtectionKeyController";var Q=dashjs.FactoryMaker.getSingletonFactory(z);function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ne(e);if(t){var s=ne(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return te(this,n)}}function te(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var re=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(n,e);var t=ee(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e.KEY_SESSION_UPDATED="public_keySessionUpdated",e}return n}(n(17).a));var se=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=n};var ie=function e(t,n,r,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=n,this.defaultURL=r,this.messageType=s||"license-request"};var ae=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=n};function oe(e){e=e||{};var t,n,r,s,i,a,o,u,E=this.context,c=e.eventBus,l=e.events,S=e.debug;function d(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function _(e){for(var t=0;t<a.length;t++)if(a[t]===e){a.splice(t,1);break}}function g(e){var t,n;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:n=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:n=e[1])),{status:t,keyId:n}}function h(e,t,r,s){var i={session:e,initData:t,sessionId:s,handleEvent:function(e){switch(e.type){case"keystatuseschange":c.trigger(l.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){var e=g(arguments);switch(e.status){case"expired":c.trigger(l.INTERNAL_KEY_STATUS_CHANGED,{error:new y.a(f.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,f.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});break;default:c.trigger(l.INTERNAL_KEY_STATUS_CHANGED,e)}}));break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;c.trigger(l.INTERNAL_KEY_MESSAGE,{data:new ie(this,t,void 0,e.messageType)})}},getSessionID:function(){return e.sessionId},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach((function(){var e=g(arguments);"usable"===e.status&&(t=!0)})),t},getSessionType:function(){return r}};return e.addEventListener("keystatuseschange",i),e.addEventListener("message",i),e.closed.then((function(){_(i),n.debug("DRM: Session closed.  SessionID = "+i.getSessionID()),c.trigger(l.KEY_SESSION_CLOSED,{data:i.getSessionID()})})),a.push(i),i}return t={getAllInitData:function(){for(var e=[],t=0;t<a.length;t++)a[t].initData&&e.push(a[t].initData);return e},requestKeySystemAccess:function(e){!function e(t,n){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess)return void c.trigger(l.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Insecure origins are not allowed"});!function(n){var r=t[n].ks,s=t[n].configs,i=r.systemString;i===A.PLAYREADY_KEYSTEM_STRING&&"required"===s[0].persistentState&&(i+=".recommendation"),navigator.requestMediaKeySystemAccess(i,s).then((function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,n=new ae(r,t);n.mksa=e,c.trigger(l.KEY_SYSTEM_ACCESS_COMPLETE,{data:n})})).catch((function(r){++n<t.length?e(t,n):c.trigger(l.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! "+r.message})}))}(n)}(e,0)},getKeySystem:function(){return r},selectKeySystem:function(e){e.mksa.createMediaKeys().then((function(t){r=e.keySystem,i=t,s?s.setMediaKeys(i).then((function(){c.trigger(l.INTERNAL_KEY_SYSTEM_SELECTED)})):c.trigger(l.INTERNAL_KEY_SYSTEM_SELECTED)})).catch((function(){c.trigger(l.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))},setMediaElement:function(e){s!==e&&(s&&(s.removeEventListener("encrypted",o),s.setMediaKeys&&s.setMediaKeys(null)),(s=e)&&(s.addEventListener("encrypted",o),s.setMediaKeys&&i&&s.setMediaKeys(i)))},setServerCertificate:function(e){if(!r||!i)throw new Error("Can not set server certificate until you have selected a key system");i.setServerCertificate(e).then((function(){n.info("DRM: License server certificate successfully updated."),c.trigger(l.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){c.trigger(l.SERVER_CERTIFICATE_UPDATED,{error:new y.a(f.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,f.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})}))},createKeySession:function(e,t,s){if(!r||!i)throw new Error("Can not create sessions until you have selected a key system");var a=i.createSession(s),o=h(a,e,s),u=this.getKeySystem().systemString===A.CLEARKEY_KEYSTEM_STRING&&(e||t&&t.clearkeys)?"keyids":"cenc";a.generateRequest(u,e).then((function(){n.debug("DRM: Session created.  SessionID = "+o.getSessionID()),c.trigger(l.KEY_SESSION_CREATED,{data:o})})).catch((function(e){_(o),c.trigger(l.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})}))},updateKeySession:function(e,t){var n=e.session;u.isClearKey(r)&&(t=t.toJWK()),n.update(t).then((function(){c.trigger(l.KEY_SESSION_UPDATED)})).catch((function(t){c.trigger(l.KEY_ERROR,{data:new y.a(f.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})}))},loadKeySession:function(e,t,s){if(!r||!i)throw new Error("Can not load sessions until you have selected a key system");for(var o=0;o<a.length;o++)if(e===a[o].sessionId)return void n.warn("DRM: Ignoring session ID because we have already seen it!");var u=i.createSession(s),E=h(u,t,s,e);u.load(e).then((function(t){t?(n.debug("DRM: Session loaded.  SessionID = "+E.getSessionID()),c.trigger(l.KEY_SESSION_CREATED,{data:E})):(_(E),c.trigger(l.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+e+")")}))})).catch((function(t){_(E),c.trigger(l.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+e+")! "+t.name)})}))},removeKeySession:function(e){e.session.remove().then((function(){n.debug("DRM: Session removed.  SessionID = "+e.getSessionID()),c.trigger(l.KEY_SESSION_REMOVED,{data:e.getSessionID()})}),(function(t){c.trigger(l.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionID()+"). "+t.name})}))},closeKeySession:function(e){d(e).catch((function(t){_(e),c.trigger(l.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionID()+") "+t.name})}))},stop:function(){for(var e,t=0;t<a.length;t++)(e=a[t]).getUsable()||d(e).catch((function(){_(e)}))},reset:function(){var e,t=a.length;0!==t?function(){for(var n=function(e){_(e),0===a.length&&(s?(s.removeEventListener("encrypted",o),s.setMediaKeys(null).then((function(){c.trigger(l.TEARDOWN_COMPLETE)}))):c.trigger(l.TEARDOWN_COMPLETE))},r=0;r<t;r++)!function(t){e.session.closed.then((function(){n(t)})),d(e).catch((function(){n(t)}))}(e=a[r])}():c.trigger(l.TEARDOWN_COMPLETE)}},n=S.getLogger(t),r=null,s=null,i=null,a=[],u=Q(E).getInstance(),o={handleEvent:function(e){switch(e.type){case"encrypted":if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;c.trigger(l.NEED_KEY,{key:new se(t,e.initDataType)})}}}},t}oe.__dashjs_factory_name="ProtectionModel_21Jan2015";var ue=dashjs.FactoryMaker.getClassFactory(oe);function Ee(e){e=e||{};var t,n,r,s,i,o,u,E,c,l=this.context,S=e.eventBus,d=e.events,_=e.debug,g=e.api;function h(){try{for(var e=0;e<u.length;e++)R(u[e]);r&&r.removeEventListener(g.needkey,E),S.trigger(d.TEARDOWN_COMPLETE)}catch(e){S.trigger(d.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function R(e){var t=e.session;t.removeEventListener(g.error,e),t.removeEventListener(g.message,e),t.removeEventListener(g.ready,e),t.removeEventListener(g.close,e);for(var n=0;n<u.length;n++)if(u[n]===e){u.splice(n,1);break}t[g.release]()}function p(){var e=null,t=function(){r.removeEventListener("loadedmetadata",e),r[g.setMediaKeys](i),S.trigger(d.VIDEO_ELEMENT_SELECTED)};r.readyState>=1?t():(e=t.bind(this),r.addEventListener("loadedmetadata",e))}return t={getAllInitData:function(){for(var e=[],t=0;t<u.length;t++)e.push(u[t].initData);return e},requestKeySystemAccess:function(e){for(var t=!1,n=0;n<e.length;n++)for(var r=e[n].ks.systemString,s=e[n].configs,i=null,o=null,u=0;u<s.length;u++){var E=s[u].audioCapabilities,l=s[u].videoCapabilities;if(E&&0!==E.length){i=[];for(var f=0;f<E.length;f++)window[g.MediaKeys].isTypeSupported(r,E[f].contentType)&&i.push(E[f])}if(l&&0!==l.length){o=[];for(var y=0;y<l.length;y++)window[g.MediaKeys].isTypeSupported(r,l[y].contentType)&&o.push(l[y])}if(!(!i&&!o||i&&0===i.length||o&&0===o.length)){t=!0;var _=new a(i,o),h=c.getKeySystemBySystemString(r);S.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{data:new ae(h,_)});break}}t||S.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return s},selectKeySystem:function(e){try{i=e.mediaKeys=new window[g.MediaKeys](e.keySystem.systemString),s=e.keySystem,o=e,r&&p(),S.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED)}catch(e){S.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+s.systemString+")! Could not create MediaKeys -- TODO"})}},setMediaElement:function(e){r!==e&&(r&&r.removeEventListener(g.needkey,E),(r=e)&&(r.addEventListener(g.needkey,E),i&&p()))},createKeySession:function(e,t,r,a){if(!s||!i||!o)throw new Error("Can not create sessions until you have selected a key system");var E=null;if(o.ksConfiguration.videoCapabilities&&o.ksConfiguration.videoCapabilities.length>0&&(E=o.ksConfiguration.videoCapabilities[0]),null===E&&o.ksConfiguration.audioCapabilities&&o.ksConfiguration.audioCapabilities.length>0&&(E=o.ksConfiguration.audioCapabilities[0]),null===E)throw new Error("Can not create sessions for unknown content types.");var c=E.contentType,l=i.createSession(c,new Uint8Array(e),a?new Uint8Array(a):null),_=function(e,t){return{session:e,initData:t,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case g.error:S.trigger(d.KEY_ERROR,{data:new y.a(f.MEDIA_KEYERR_CODE,"KeyError",this)});break;case g.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;S.trigger(d.INTERNAL_KEY_MESSAGE,{data:new ie(this,t,e.destinationURL)});break;case g.ready:n.debug("DRM: Key added."),S.trigger(d.KEY_ADDED);break;case g.close:n.debug("DRM: Session closed.  SessionID = "+this.getSessionID()),S.trigger(d.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}(l,e);l.addEventListener(g.error,_),l.addEventListener(g.message,_),l.addEventListener(g.ready,_),l.addEventListener(g.close,_),u.push(_),n.debug("DRM: Session created.  SessionID = "+_.getSessionID()),S.trigger(d.KEY_SESSION_CREATED,{data:_})},updateKeySession:function(e,t){var n=e.session;c.isClearKey(s)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t)),S.trigger(d.KEY_SESSION_UPDATED)},closeKeySession:R,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:h,reset:h},n=_.getLogger(t),r=null,s=null,i=null,o=null,u=[],c=Q(l).getInstance(),E={handleEvent:function(e){switch(e.type){case g.needkey:if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;S.trigger(d.NEED_KEY,{key:new se(t,"cenc")})}}}},t}Ee.__dashjs_factory_name="ProtectionModel_3Feb2014";var ce=dashjs.FactoryMaker.getClassFactory(Ee);function le(e){e=e||{};var t,n,r,s,i,o,u,E,c,l=this.context,S=e.eventBus,d=e.events,_=e.debug,g=e.api,h=e.errHandler;function R(){r&&D();for(var e=0;e<u.length;e++)p(u[e]);S.trigger(d.TEARDOWN_COMPLETE)}function p(e){try{r[g.cancelKeyRequest](s.systemString,e.sessionID)}catch(t){S.trigger(d.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionID+") "+t.message})}}function m(e,t){if(t&&e){for(var n=e.length,r=0;r<n;r++)if(e[r].sessionID==t)return e[r];return null}return null}function D(){r.removeEventListener(g.keyerror,c),r.removeEventListener(g.needkey,c),r.removeEventListener(g.keymessage,c),r.removeEventListener(g.keyadded,c)}return t={getAllInitData:function(){for(var e=[],t=0;t<o.length;t++)e.push(o[t].initData);for(var n=0;n<u.length;n++)e.push(u[n].initData);return e},requestKeySystemAccess:function(e){var t=r;t||(t=document.createElement("video"));for(var n=!1,s=0;s<e.length;s++)for(var o=e[s].ks.systemString,u=e[s].configs,E=null,c=0;c<u.length;c++){var l=u[c].videoCapabilities;if(l&&0!==l.length){E=[];for(var f=0;f<l.length;f++)""!==t.canPlayType(l[f].contentType,o)&&E.push(l[f])}if(E&&(!E||0!==E.length)){n=!0;var y=new a(null,E),_=i.getKeySystemBySystemString(o);S.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{data:new ae(_,y)});break}}n||S.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return s},selectKeySystem:function(e){s=e.keySystem,S.trigger(d.INTERNAL_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){if(r!==e){if(r){D();for(var t=0;t<u.length;t++)p(u[t]);u=[]}(r=e)&&(r.addEventListener(g.keyerror,c),r.addEventListener(g.needkey,c),r.addEventListener(g.keymessage,c),r.addEventListener(g.keyadded,c),S.trigger(d.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!s)throw new Error("Can not create sessions until you have selected a key system");if(E||0===u.length){var t={sessionID:null,initData:e,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return o.push(t),r[g.generateKeyRequest](s.systemString,new Uint8Array(e)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var n=e.sessionID;if(i.isClearKey(s))for(var a=0;a<t.keyPairs.length;a++)r[g.addKey](s.systemString,t.keyPairs[a].key,t.keyPairs[a].keyID,n);else r[g.addKey](s.systemString,new Uint8Array(t),new Uint8Array(e.initData),n);S.trigger(d.KEY_SESSION_UPDATED)},closeKeySession:p,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:R,reset:R},n=_.getLogger(t),r=null,s=null,o=[],u=[],i=Q(l).getInstance(),c={handleEvent:function(e){var t=null;switch(e.type){case g.needkey:var r=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;S.trigger(d.NEED_KEY,{key:new se(r,"cenc")});break;case g.keyerror:if((t=m(u,e.sessionId))||(t=m(o,e.sessionId)),t){var s=f.MEDIA_KEYERR_CODE,i="";switch(e.errorCode.code){case 1:s=f.MEDIA_KEYERR_UNKNOWN_CODE,i+="MEDIA_KEYERR_UNKNOWN - "+f.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:s=f.MEDIA_KEYERR_CLIENT_CODE,i+="MEDIA_KEYERR_CLIENT - "+f.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:s=f.MEDIA_KEYERR_SERVICE_CODE,i+="MEDIA_KEYERR_SERVICE - "+f.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:s=f.MEDIA_KEYERR_OUTPUT_CODE,i+="MEDIA_KEYERR_OUTPUT - "+f.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:s=f.MEDIA_KEYERR_HARDWARECHANGE_CODE,i+="MEDIA_KEYERR_HARDWARECHANGE - "+f.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:s=f.MEDIA_KEYERR_DOMAIN_CODE,i+="MEDIA_KEYERR_DOMAIN - "+f.MEDIA_KEYERR_DOMAIN_MESSAGE}i+="  System Code = "+e.systemCode,S.trigger(d.KEY_ERROR,{data:new y.a(s,i,t)})}else n.error("No session token found for key error");break;case g.keyadded:(t=m(u,e.sessionId))||(t=m(o,e.sessionId)),t?(n.debug("DRM: Key added."),S.trigger(d.KEY_ADDED,{data:t})):n.debug("No session token found for key added");break;case g.keymessage:if((E=null!==e.sessionId&&void 0!==e.sessionId)?!(t=m(u,e.sessionId))&&o.length>0&&(t=o.shift(),u.push(t),t.sessionID=e.sessionId,S.trigger(d.KEY_SESSION_CREATED,{data:t})):o.length>0&&(t=o.shift(),u.push(t),0!==o.length&&h.error(new y.a(f.MEDIA_KEY_MESSAGE_ERROR_CODE,f.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var a=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=a,S.trigger(d.INTERNAL_KEY_MESSAGE,{data:new ie(t,a,e.defaultURL)})}else n.warn("No session token found for key message")}}},t}le.__dashjs_factory_name="ProtectionModel_01b";var fe=dashjs.FactoryMaker.getClassFactory(le),ye=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],Se=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function de(){var e,t=this.context;function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];if("function"==typeof e[r[Object.keys(r)[0]]])return r}return null}return e={createProtectionSystem:function(r){var s=null,i=Q(t).getInstance();i.setConfig({debug:r.debug,BASE64:r.BASE64}),i.initialize();var a=function(r){var s=r.debug,i=s.getLogger(e),a=r.eventBus,o=r.errHandler,u=r.videoModel?r.videoModel.getElement():null;return u&&void 0===u.onencrypted||u&&void 0===u.mediaKeys?n(u,Se)?(i.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),ce(t).create({debug:s,eventBus:a,events:r.events,api:n(u,Se)})):n(u,ye)?(i.info("EME detected on this user agent! (ProtectionModel_01b)"),fe(t).create({debug:s,eventBus:a,errHandler:o,events:r.events,api:n(u,ye)})):(i.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(i.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),ue(t).create({debug:s,eventBus:a,events:r.events}))}(r);return!s&&a&&(s=m(t).create({protectionModel:a,protectionKeyController:i,eventBus:r.eventBus,debug:r.debug,events:r.events,BASE64:r.BASE64,constants:r.constants,cmcdModel:r.cmcdModel,settings:r.settings}),r.capabilities.setEncryptedMediaSupported(!0)),s}}}de.__dashjs_factory_name="Protection";var _e=dashjs.FactoryMaker.getClassFactory(de);_e.events=re,_e.errors=f,dashjs.FactoryMaker.updateClassFactory(de.__dashjs_factory_name,_e);t.default=_e},8:function(e,t,n){"use strict";t.a=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=n||null,this.data=r||null}}}).default}));
//# sourceMappingURL=dash.protection.min.js.map